<templates>
  <t t-name="o-spreadsheet-Composer">
    <div class="o-composer-container w-100 h-100" t-ref="composerContainer">
      <t t-set="autoCompleteProposals" t-value="props.composerStore.autoCompleteProposals"/>
      <t t-set="canBeToggled" t-value="props.composerStore.canBeToggled"/>
      <t
        t-set="assistantIsAvailable"
        t-value="props.showAssistant and (autoCompleteProposals.length or functionDescriptionState.showDescription)"
      />
      <div class="d-flex flex-row position-relative">
        <span
          t-if="props.focus !== 'inactive' and assistantIsAvailable and canBeToggled and assistant.forcedClosed"
          role="button"
          title="Show formula help"
          t-on-click.stop="openAssistant"
          t-on-pointerdown.prevent.stop=""
          t-on-pointerup.stop=""
          class="fa-stack position-absolute translate-middle force-open-assistant fs-4">
          <i class="fa fa-circle fa-stack-1x fa-inverse"/>
          <i class="fa fa-question-circle fa-stack-1x"/>
        </span>
        <div
          class="o-composer w-100 text-start"
          t-att-class="{ 'text-muted': env.model.getters.isReadonly(), 'active': props.focus !== 'inactive' }"
          t-att-style="props.inputStyle"
          t-ref="o_composer"
          tabindex="1"
          t-att-contenteditable="env.model.getters.isReadonly() ? 'false' : 'plaintext-only'"
          t-att-placeHolder="props.placeholder"
          t-att-inputmode="props.inputMode"
          spellcheck="false"
          t-on-keydown="onKeydown"
          t-on-mousewheel.stop=""
          t-on-input="onInput"
          t-on-pointerdown="onMousedown"
          t-on-pointerup="onMouseup"
          t-on-click="onClick"
          t-on-keyup="onKeyup"
          t-on-paste="onPaste"
          t-on-compositionstart="onCompositionStart"
          t-on-compositionend="onCompositionEnd"
          t-on-dblclick="onDblClick"
          t-on-contextmenu="onContextMenu"
          t-on-blur="onBlur"
          t-on-wheel="onWheel"
        />
      </div>
      <div
        class="o-composer-assistant-container shadow position-absolute z-1"
        t-att-style="assistantContainerStyle"
        t-if="props.focus !== 'inactive' and assistantIsAvailable and !(canBeToggled and assistant.forcedClosed)"
        t-on-wheel.stop=""
        t-on-pointerdown.stop=""
        t-on-pointerup.stop=""
        t-on-click.stop="">
        <span
          t-if="canBeToggled and !assistant.forcedClosed"
          role="button"
          t-on-click="closeAssistant"
          t-on-pointerdown.prevent.stop=""
          class="fa-stack position-absolute top-0 start-100 translate-middle fs-4">
          <i class="fa fa-circle fa-stack-1x fa-inverse"/>
          <i class="fa fa-times-circle fa-stack-1x"/>
        </span>
        <div class="o-composer-assistant overflow-auto" t-att-style="assistantStyle">
          <FunctionDescriptionProvider
            t-if="functionDescriptionState.showDescription"
            functionDescription="functionDescriptionState.functionDescription"
            argsToFocus="functionDescriptionState.argsToFocus"
            repeatingArgGroupIndex="functionDescriptionState.repeatingArgGroupIndex"
          />
          <div
            t-if="functionDescriptionState.showDescription and autoCompleteProposals.length"
            class="border-top"
          />
          <TextValueProvider
            t-if="autoCompleteProposals.length"
            proposals="autoCompleteProposals"
            selectedIndex="props.composerStore.autoCompleteSelectedIndex"
            onValueSelected.bind="this.autoComplete"
            onValueHovered.bind="props.composerStore.selectAutoCompleteIndex"
          />
        </div>
      </div>
      <SpeechBubble
        t-if="displaySpeechBubble"
        content="props.composerStore.hoveredContentEvaluation"
        anchorRect="composerState.hoveredRect"
      />
    </div>
  </t>
</templates>
