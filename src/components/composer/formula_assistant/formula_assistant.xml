<templates>
  <t t-name="o-spreadsheet-FunctionDescriptionProvider">
    <div class="o-formula-assistant-container user-select-none shadow">
      <t t-set="context" t-value="getContext()"/>
      <div class="o-formula-assistant" t-if="context.functionDescription.name">
        <div class="o-formula-assistant-head d-flex flex-row justify-content-between">
          <div>
            <t t-foreach="formulaHeaderContent" t-as="part" t-key="part_index">
              <span
                t-esc="part.content"
                t-att-class="part.focused ? 'o-formula-assistant-focus' : ''"
              />
            </t>
          </div>
          <div
            class="collapsor px-2 d-flex align-items-center rounded"
            t-att-class="state.isCollapsed ? 'collapsed' : ''"
            t-on-click="() => this.toggle()">
            <span class="collapsor-arrow d-inline-block">
              <t t-call="o-spreadsheet-Icon.ANGLE_DOWN"/>
            </span>
          </div>
        </div>

        <Collapse isCollapsed="state.isCollapsed">
          <div class="o-formula-assistant-core pb-3 m-3">
            <div class="o-formula-assistant-gray">ABOUT</div>
            <div t-esc="context.functionDescription.description"/>
          </div>

          <t
            t-set="firstRepeatableGroupOptional"
            t-value="context.functionDescription.args.some(arg => arg.repeating and arg.optional)"
          />

          <t t-foreach="context.functionDescription.args" t-as="arg" t-key="arg.name">
            <div
              class="o-formula-assistant-arg p-3 pt-0 display-flex flex-column"
              t-att-class="{'o-formula-assistant-gray': context.argsToFocus.length > 0}">
              <div
                t-att-class="{'o-formula-assistant-focus': context.argsToFocus.includes(arg_index)}">
                <span t-if="arg.repeating">
                  <span t-esc="arg.name + (context.repeatingArgGroupIndex + 1)"/>
                </span>
                <span t-else="">
                  <span t-esc="arg.name"/>
                </span>
                <span
                  t-if="arg.optional || arg.default || (arg.repeating and (firstRepeatableGroupOptional or context.repeatingArgGroupIndex > 0))">&#xA0;- [optional]&#xA0;</span>
                <span t-if="arg.default">
                  <span>default:&#xA0;</span>
                  <t t-esc="arg.defaultValue"/>
                </span>
              </div>
              <div class="o-formula-assistant-arg-description" t-esc="arg.description"/>
            </div>
          </t>
        </Collapse>
      </div>
    </div>
  </t>
</templates>
