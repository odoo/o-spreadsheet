<templates>
  <t t-name="o-spreadsheet-Grid">
    <div
      class="o-grid w-100 h-100 o-zoomable"
      tabindex="-1"
      composerFocusableElement="true"
      t-on-click="focusDefaultElement"
      t-on-keydown="onKeydown"
      t-on-wheel.prevent="onMouseWheel"
      t-ref="grid">
      <GridOverlay
        onCellClicked.bind="onCellClicked"
        onCellDoubleClicked.bind="onCellDoubleClicked"
        onCellRightClicked.bind="onCellRightClicked"
        onGridResized.bind="onGridResized"
        onGridMoved.bind="moveCanvas"
        gridOverlayDimensions="gridOverlayDimensions"
      />
      <HeadersOverlay onOpenContextMenu="(type, x, y) => this.toggleContextMenu(type, x, y)"/>
      <GridComposer
        gridDims="env.model.getters.getSheetViewDimensionWithHeaders()"
        onInputContextMenu.bind="onInputContextMenu"
      />
      <canvas t-ref="canvas"/>
      <t t-set="focused" t-value="focusedClients"/>
      <t
        t-foreach="env.model.getters.getClientsToDisplay()"
        t-as="client"
        t-key="getClientPositionKey(client)">
        <ClientTag
          name="client.name"
          color="client.color"
          col="client.position.col"
          row="client.position.row"
          active="isCellHovered(client.position.col, client.position.row) || focused.has(client.id)"
        />
      </t>
      <GridPopover
        t-if="!menuState.isOpen"
        gridRect="getGridRect()"
        onMouseWheel.bind="onMouseWheel"
        onClosePopover.bind="onClosePopover"
      />
      <t t-if="env.model.getters.isGridSelectionActive() and !env.isMobile()">
        <Autofill position="getAutofillPosition()" isVisible="isAutofillVisible"/>
      </t>
      <t t-foreach="highlights" t-as="highlight" t-key="highlight_index">
        <t
          t-if="highlight.interactive and highlight.range.sheetId === env.model.getters.getActiveSheetId()">
          <Highlight range="highlight.range" color="highlight.color"/>
        </t>
      </t>
      <Selection t-if="displaySelectionHandler"/>
      <MenuPopover
        t-if="menuState.isOpen"
        menuItems="menuState.menuItems"
        anchorRect="menuState.anchorRect"
        onClose="() => this.closeMenu()"
      />
      <t t-foreach="staticTables" t-as="table" t-key="table.id">
        <TableResizer table="table"/>
      </t>
      <VerticalScrollBar topOffset="HEADER_HEIGHT"/>
      <HorizontalScrollBar leftOffset="HEADER_WIDTH"/>
      <div class="o-scrollbar corner border-top border-start"/>
    </div>
  </t>
</templates>
