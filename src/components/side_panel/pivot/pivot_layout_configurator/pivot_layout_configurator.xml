<templates>
  <t t-name="o-spreadsheet-PivotLayoutConfigurator">
    <div class="o_side_panel_section pivot-dimensions o-section" t-ref="pivot-dimensions">
      <div
        class="fw-bold py-1 d-flex flex-row justify-content-between align-items-center o-section-title">
        Columns
        <AddDimensionButton
          onFieldPicked.bind="addColumnDimension"
          fields="props.unusedGroupableFields"
        />
      </div>
      <t t-foreach="props.definition.columns" t-as="col" t-key="col.nameWithGranularity">
        <div
          t-on-pointerdown="(ev) => this.startDragAndDrop(col, ev)"
          t-att-style="dragAndDrop.itemsStyle[col.nameWithGranularity]"
          class="pt-1">
          <PivotDimension dimension="col" onRemoved.bind="removeDimension">
            <PivotDimensionGranularity
              t-if="isDateField(col)"
              dimension="col"
              onUpdated.bind="this.updateGranularity"
              availableGranularities="props.unusedDateTimeGranularities[col.fieldName]"
              allGranularities="props.allGranularities"
            />
            <PivotDimensionOrder dimension="col" onUpdated.bind="this.updateOrder"/>
          </PivotDimension>
        </div>
      </t>
      <div
        class="fw-bold pt-4 pb-1 d-flex flex-row justify-content-between align-items-center o-section-title"
        t-att-style="dragAndDrop.itemsStyle['__rows_title__']">
        Rows
        <AddDimensionButton
          onFieldPicked.bind="addRowDimension"
          fields="props.unusedGroupableFields"
        />
      </div>
      <t t-foreach="props.definition.rows" t-as="row" t-key="row.nameWithGranularity">
        <div
          t-on-pointerdown="(ev) => this.startDragAndDrop(row, ev)"
          t-att-style="dragAndDrop.itemsStyle[row.nameWithGranularity]"
          class="pt-1">
          <PivotDimension dimension="row" onRemoved.bind="removeDimension">
            <PivotDimensionGranularity
              t-if="isDateField(row)"
              dimension="row"
              onUpdated.bind="this.updateGranularity"
              availableGranularities="props.unusedDateTimeGranularities[row.fieldName]"
              allGranularities="props.allGranularities"
            />
            <PivotDimensionOrder dimension="row" onUpdated.bind="this.updateOrder"/>
          </PivotDimension>
        </div>
      </t>
      <div
        class="fw-bold pt-4 pb-1 d-flex flex-row justify-content-between align-items-center o-section-title o-pivot-measure">
        Measures
        <AddDimensionButton onFieldPicked.bind="addMeasureDimension" fields="props.measureFields">
          <div
            t-on-click="addCalculatedMeasure"
            class="p-2 bg-white border-top d-flex align-items-center sticky-bottom add-calculated-measure">
            <i class="pe-1">
              <t t-call="o-spreadsheet-Icon.FORMULA"/>
            </i>
            Add calculated measure
          </div>
        </AddDimensionButton>
      </div>
      <t t-foreach="props.definition.measures" t-as="measure" t-key="measure.id">
        <div
          t-on-pointerdown="(ev) => this.startDragAndDropMeasures(measure, ev)"
          t-att-style="dragAndDrop.itemsStyle[measure.id]"
          t-att-class="measure.isHidden ? 'opacity-50' : ''"
          class="pt-1 pivot-measure">
          <PivotDimension
            dimension="measure"
            onRemoved.bind="removeMeasureDimension"
            onNameUpdated.bind="onMeasureNameUpdated">
            <t t-set-slot="upper-right-icons">
              <t t-if="measure.isHidden" t-set="hideTitle">Show</t>
              <t t-else="" t-set="hideTitle">Hide</t>
              <i
                t-att-class="measure.isHidden ? 'fa fa-eye-slash': 'fa fa-eye'"
                t-att-title="hideTitle"
                class="btn o-text-muted"
                t-on-click="() => this.toggleMeasureVisibility(measure)"
              />
            </t>
            <div t-if="measure.computedBy" class="d-flex flex-row small">
              <div class="d-flex flex-column py-2 px-2 w-100">
                <StandaloneComposer
                  onConfirm="(content) => this.updateMeasureFormula(measure, content)"
                  composerContent="measure.computedBy.formula"
                  defaultRangeSheetId="measure.computedBy.sheetId"
                  contextualAutocomplete="getMeasureAutocomplete(measure)"
                />
              </div>
            </div>
            <div class="d-flex flex-column small">
              <div class="d-flex py-1 px-2 w-100">
                <div class="pivot-dim-operator-label">Aggregated by</div>
                <select
                  class="o-input flex-grow-1 me-3"
                  t-on-change="(ev) => this.updateAggregator(measure, ev.target.value)">
                  <option
                    t-foreach="Object.keys(AGGREGATORS[measure.type])"
                    t-as="agg"
                    t-key="agg"
                    t-att-value="agg"
                    t-att-selected="agg === measure.aggregator"
                    t-esc="AGGREGATORS[measure.type][agg]"
                  />
                </select>
              </div>
            </div>
          </PivotDimension>
        </div>
      </t>
    </div>
  </t>
</templates>
