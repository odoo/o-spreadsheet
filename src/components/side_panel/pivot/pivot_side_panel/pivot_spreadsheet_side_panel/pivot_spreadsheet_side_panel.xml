<templates>
  <t t-name="o-spreadsheet-PivotSpreadsheetSidePanel">
    <t t-set="isReadonly" t-value="env.model.getters.isReadonly()"/>
    <div class="d-flex flex-column h-100 justify-content-between overflow-hidden">
      <div class="h-100 position-relative overflow-x-hidden overflow-y-auto" t-ref="pivotSidePanel">
        <div
          t-att="isReadonly ? ['inert', 1] : []"
          t-att-class="{ 'pe-none opacity-50': isReadonly }">
          <PivotTitleSection pivotId="props.pivotId" flipAxis.bind="flipAxis"/>
          <Section title.translate="Range">
            <SelectionInput
              ranges="ranges"
              required="true"
              isInvalid="shouldDisplayInvalidRangeError"
              hasSingleRange="true"
              onSelectionChanged="(ranges) => this.onSelectionChanged(ranges)"
              onSelectionConfirmed="() => this.onSelectionConfirmed()"
            />
            <span
              class="text-danger sp_range_error_message"
              t-if="shouldDisplayInvalidRangeError"
              t-esc="pivot.invalidRangeMessage"
            />
          </Section>

          <PivotLayoutConfigurator
            t-if="!pivot.isInvalidRange"
            unusedGroupableFields="store.unusedGroupableFields"
            measureFields="store.measureFields"
            unusedGranularities="store.unusedGranularities"
            dateGranularities="store.dateGranularities"
            datetimeGranularities="store.datetimeGranularities"
            definition="definition"
            onDimensionsUpdated.bind="onDimensionsUpdated"
            onFiltersUpdated.bind="onFiltersUpdated"
            getScrollableContainerEl.bind="getScrollableContainerEl"
            pivotId="props.pivotId"
          />
          <t t-if="!pivot.isInvalidRange">
            <Section class="'pt-0'">
              <div
                class="o-fw-bold pt-0 pb-1 d-flex flex-row justify-content-between align-items-center o-section-title">
                Filters
                <AddDimensionButton
                  onFieldPicked.bind="addFilter"
                  fields="store.unusedFilterFields"
                />
              </div>
              <t t-foreach="definition.filters" t-as="filter" t-key="filter_index">
                <PivotFilterEditor
                  pivotId="props.pivotId"
                  definition="definition"
                  filter="filter"
                  onFiltersUpdated.bind="onFiltersUpdated"
                />
              </t>
            </Section>
          </t>
        </div>
      </div>
      <PivotDeferUpdate
        t-if="!isReadonly"
        deferUpdate="store.updatesAreDeferred"
        toggleDeferUpdate="(value) => store.deferUpdates(value)"
        isDirty="store.isDirty"
        discard="store.discardPendingUpdate"
        apply="store.applyUpdate"
      />
    </div>
  </t>
</templates>
