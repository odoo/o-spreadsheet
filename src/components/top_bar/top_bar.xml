<templates>
  <t t-name="o-spreadsheet-TopBar">
    <div
      class="o-spreadsheet-topbar d-flex flex-column user-select-none"
      t-on-click="props.onClick">
      <div t-if="!env.isSmall" class="o-topbar-top d-flex justify-content-between">
        <!-- Menus -->
        <div class="o-topbar-topleft d-flex">
          <t t-foreach="menus" t-as="menu" t-key="menu_index">
            <div
              t-if="menu.children.length !== 0"
              class="o-topbar-menu o-hoverable-button text-nowrap rounded"
              t-att-class="{'active': state.menuState.parentMenu and state.menuState.parentMenu.id === menu.id}"
              t-on-click="(ev) => this.toggleContextMenu(menu, ev)"
              t-on-mouseover="(ev) => this.onMenuMouseOver(menu, ev)"
              t-att-data-id="menu.id">
              <t t-esc="getMenuName(menu)"/>
            </div>
          </t>
        </div>
        <div class="o-topbar-topright d-flex justify-content-end align-items-center">
          <div t-foreach="topbarComponents" t-as="comp" t-key="comp.id" class="px-1">
            <t t-component="comp.component"/>
          </div>
        </div>
      </div>
      <!-- Toolbar and Cell Content -->
      <div
        class="d-flex o-topbar-responsive"
        t-att-class="{'o-topbar-responsive': !env.model.getters.isReadonly()}"
        t-ref="toolBarContainer">
        <div
          class="o-topbar-toolbar d-flex"
          t-att-class="{'flex-shrink-0': env.model.getters.isReadonly()}">
          <!-- Toolbar -->
          <div
            t-if="env.model.getters.isReadonly()"
            class="o-readonly-toolbar d-flex align-items-center text-muted">
            <span>
              <i class="fa fa-eye"/>
              Readonly Access
            </span>
          </div>
          <div t-else="" class="o-toolbar-tools d-flex ms-4 flex-grow-1" t-ref="toolBar">
            <div
              class="d-flex tool-container"
              t-foreach="toolsCategories"
              t-as="category"
              t-key="category"
              t-att-id="category">
              <t
                t-foreach="toolbarMenuRegistry.getEntries(category)"
                t-as="toolbarAction"
                t-key="toolbarAction_index">
                <t t-component="toolbarAction.component" t-props="toolbarAction.props"/>
              </t>
              <div t-if="showDivider(category_index)" class="o-topbar-divider"/>
            </div>
            <div
              t-ref="moreToolsContainer"
              class="d-flex align-items-center flex-grow-1 me-auto more-tools-container">
              <span
                class="o-toolbar-button o-menu-item-button o-hoverable-button  me-2 px-1 py-2 more-tools"
                t-ref="moreToolsButton"
                t-on-click.stop="toggleMoreTools">
                <t t-call="o-spreadsheet-Icon.SHORT_THIN_DRAG_HANDLE"/>
              </span>
            </div>
          </div>
        </div>
        <TopBarComposer t-if="!env.isSmall"/>
      </div>
      <div
        t-if="this.fingerprints.isEnabled"
        class="topbar-banner irregularity-map d-flex align-items-center justify-content-between">
        <div
          t-on-click="() => this.fingerprints.disable()"
          role="button"
          title="This tool analyzes spreadsheet formulas for patterns and highlights inconsistencies. Irregularities may indicate potential errors in formula structures, references, or arguments. (Click to turn off)"
          class="h-100 d-flex align-items-center text-info px-3">
          <t t-call="o-spreadsheet-Icon.IRREGULARITY_MAP"/>
          Irregularity map
        </div>
        <div
          class="ps-3 h-100 flex-fill d-flex justify-content-between rounded-0 alert alert-info ps-0 py-0 my-0">
          <span class="d-flex align-items-center">
            This tool analyzes formulas for patterns and highlights inconsistencies. Irregularities
            may indicate potential errors in formula structures, references or arguments.
          </span>
          <div
            class="ps-3 btn btn-link flex-shrink-0"
            t-on-click="() => this.fingerprints.disable()">
            Turn off
          </div>
        </div>
      </div>
    </div>
    <MenuPopover
      t-if="state.menuState.isOpen"
      anchorRect="state.menuState.anchorRect"
      menuItems="state.menuState.menuItems"
      onClose="() => this.closeMenus()"
      onMenuClicked="() => this.props.onClick()"
      popoverPositioning="'bottom-left'"
    />
    <Popover t-if="state.toolsPopoverState.isOpen" t-props="toolsPopoverProps">
      <div class="d-flex px-2 py-1 flex-wrap align-items-center" style="background-color:white;">
        <t
          t-foreach="state.invisibleToolsCategories"
          t-as="category"
          t-key="category"
          t-att-id="category">
          <t
            t-foreach="toolbarMenuRegistry.getEntries(category)"
            t-as="toolbarAction"
            t-key="toolbarAction_index">
            <t t-component="toolbarAction.component" t-props="toolbarAction.props"/>
          </t>
          <div
            t-if="category_index &lt; state.invisibleToolsCategories.length-1"
            class="o-topbar-divider"
          />
        </t>
      </div>
    </Popover>
  </t>
</templates>
